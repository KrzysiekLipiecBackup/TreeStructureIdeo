@model IEnumerable<TreeStructureIdeo.Models.Knots>

@{
    ViewData["Title"] = "Index";
}

<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table">
    @{

        List<KnotElements> initModel = new List<KnotElements>();
        foreach (var i in Model)
        {
            KnotElements temp = new KnotElements(i);
            initModel.Add(temp);
        }

        foreach (var i in initModel)    //child
        {
            foreach(var j in initModel) //parrent
            {
                if(j.Id == i.ParentId)
                {
                    j.AddChildren(i);
                }
            }
        }


        //List<KnotElements> InitModel = new List<KnotElements>(Model.ToList());


        async Task<string> Recursion(List<TreeStructureIdeo.Models.KnotElements> kElements)
        {
            <thead>
                <tr>
                    <th></th>
                    <th>
                        @Html.DisplayNameFor(model => model.Id)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.ParentId)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Text)
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in kElements)
                {
                    <tr>
                        @if (item.Children.Any())
                        {
                        <td>
                            <strong>></strong>
                        </td>
                        }
                        else
                        {
                            <td></td>
                        }
                        <td>
                            @Html.DisplayFor(modelItem => item.Id)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ParentId)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Text)
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                            <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                            <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                        </td>
                    </tr>
                    if (item.Children.Any())
                    {
                        @await Recursion(item.Children);
                    }
                }
                </tbody>
            return "why";
        }

        @Recursion(initModel[0].Children);
    }
</table>
